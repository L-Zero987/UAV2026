参考25赛季无人机代码gimbal

# 主要状态以及状态说明

![image-20250819185743367](https://gitee.com/lzero123/typora_-img/raw/master/PicGo/image-20250819185743367.png)

```c++
typedef enum
{
    Disable            = 0x00, // 失能
    ControlWithEncoder = 0x01, // 编码器的手动控制
    ControlWithIMU     = 0x02, // 陀螺仪的手动控制
    AutoControl        = 0x03, // 自瞄
} Gimbal_State_e;
```

Disable:
	进入状态：PID角度反馈改为电机反馈值
			  将设定值改为当前电机反馈值
			  计时器清零
​	状态循环：检测 拨杆居中 切换 CWI 状态
​			  检测 拨杆上拨 切换 Auto 状态
​			  计时器未到指定时间 调用限位检测函数
​			  计时器未到指定时间 计时器计时
​			  计时器未到指定时间 两电机使能
​			  计时器到指定时间 两电机失能
​	退出状态：清空PID误差累计值

CWE：
	进入状态：PID角度反馈改为电机反馈值
			  将设定值改为当前电机反馈值
			  计时器清零
​	状态循环：电机使能
​			  调用CtrlMove函数，更新目标值
​			  调用限位检测函数
			  填充发送数据
			  检测 拨杆下拨 切换 Disable 状态
			  检测 拨杆上拨 切换 Auto 状态
​			  检测 左拨杆左上角 计时器计时
			  检测 左拨杆左上角 计时器到指定时间 切换 CWI 状态
​			  检测 左拨杆不在左上角 计时器清零
​	退出状态：清空PID误差累计值

CWI：
	进入状态：PID角度反馈改为陀螺仪角度
			  将设定值改为当前陀螺仪角度
			  计时器清零
	状态循环：电机使能
			  调用CtrlMove函数，更新目标值
			  调用限位检测函数
			  pitch 角度环计算，填充发送数据
			  检测 拨杆下拨 切换 Disable 状态
			  检测 拨杆上拨 切换 Auto 状态
​			  检测 左拨杆右下角 计时器计时
			  检测 左拨杆右下角 计时器到指定时间 切换 CWE 状态
​			  检测 左拨杆不在右下角 计时器清零
​	退出状态：清空PID误差累计值

AC：
	进入状态：PID角度反馈改为陀螺仪角度
			  将设定值改为当前陀螺仪角度
	状态循环：电机使能
			  调用CtrlMove_Auto函数，更新目标值
			  调用限位检测函数
			  pitch 角度环计算，填充发送数据
			  检测 拨杆下拨 切换 Disable 状态
			  检测 拨杆居中 切换 CWI 状态
	退出状态：清空PID误差累计值

注意，yaw大疆电机模块代码内置pid计算，但是pitch达妙没有，所以在gimbal类里面有一个关于pitch的角度pid环，在imu模式的时候使用
同样，yaw大疆电机模块代码的电机发送内置了pid计算环节，但是pitch达妙没有，在gimbal类内也要进行pid计算以及填充数据准备发送
但是，gimbal逻辑循环为1kHz，电机发送循环为500Hz，导致两个电机发送频率相同但是pid计算频率差了1倍，需要注意pid中有关前馈以及误差累计的计算